# SSL è¯ä¹¦æ–‡ä»¶å­˜æ”¾è¯´æ˜

## ğŸ“ è¯ä¹¦æ–‡ä»¶å­˜æ”¾ä½ç½®

### é¡¹ç›®ç›®å½•ç»“æ„

å°†è¯ä¹¦æ–‡ä»¶æ”¾åœ¨é¡¹ç›®çš„ `ssl/` ç›®å½•ä¸‹ï¼Œç»“æ„å¦‚ä¸‹ï¼š

```
nginx-shop/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ nginx.conf
â”œâ”€â”€ html/
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ ssl/                          â† è¯ä¹¦ç›®å½•ï¼ˆéœ€è¦åˆ›å»ºï¼‰
â”‚   â””â”€â”€ guopengfei.top/          â† åŸŸåç›®å½•
â”‚       â”œâ”€â”€ fullchain.crt        â† è¯ä¹¦æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
â”‚       â””â”€â”€ private.key          â† ç§é’¥æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
â””â”€â”€ logs/
```

### è¯¦ç»†è¯´æ˜

#### 1. åˆ›å»ºè¯ä¹¦ç›®å½•

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºè¯ä¹¦ç›®å½•ï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
mkdir -p ssl/guopengfei.top
```

#### 2. è¯ä¹¦æ–‡ä»¶å‘½å

å°†ä¸‹è½½çš„è¯ä¹¦æ–‡ä»¶é‡å‘½åå¹¶æ”¾åˆ°å¯¹åº”ç›®å½•ï¼š

**è¯ä¹¦æ–‡ä»¶ï¼ˆå…¬é’¥ï¼‰ï¼š**
- ä¸‹è½½çš„æ–‡ä»¶åå¯èƒ½æ˜¯ï¼š`certificate.crt`ã€`cert.crt`ã€`fullchain.pem` ç­‰
- é‡å‘½åä¸ºï¼š`fullchain.crt`
- å­˜æ”¾ä½ç½®ï¼š`ssl/guopengfei.top/fullchain.crt`

**ç§é’¥æ–‡ä»¶ï¼š**
- ä¸‹è½½çš„æ–‡ä»¶åå¯èƒ½æ˜¯ï¼š`private.key`ã€`key.key`ã€`private.pem` ç­‰
- é‡å‘½åä¸ºï¼š`private.key`
- å­˜æ”¾ä½ç½®ï¼š`ssl/guopengfei.top/private.key`

#### 3. æ–‡ä»¶æƒé™è®¾ç½®

ä¸ºäº†å®‰å…¨ï¼Œå»ºè®®è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ï¼š

```bash
# è®¾ç½®è¯ä¹¦æ–‡ä»¶æƒé™ï¼ˆå¯è¯»ï¼‰
chmod 644 ssl/guopengfei.top/fullchain.crt

# è®¾ç½®ç§é’¥æ–‡ä»¶æƒé™ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»ï¼Œéå¸¸é‡è¦ï¼ï¼‰
chmod 600 ssl/guopengfei.top/private.key
```

**é‡è¦ï¼š** ç§é’¥æ–‡ä»¶å¿…é¡»ä¿å¯†ï¼Œæƒé™è®¾ç½®ä¸º 600ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å¯å†™ï¼‰ã€‚

---

## ğŸ“¤ å¦‚ä½•ä¸Šä¼ è¯ä¹¦åˆ°æœåŠ¡å™¨

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ SCPï¼ˆæ¨èï¼‰

ä»æœ¬åœ° Windows ä¸Šä¼ åˆ° Linux æœåŠ¡å™¨ï¼š

```powershell
# åœ¨ Windows PowerShell ä¸­æ‰§è¡Œ
# å‡è®¾è¯ä¹¦æ–‡ä»¶åœ¨æœ¬åœ° D:\certificates\ ç›®å½•

# ä¸Šä¼ è¯ä¹¦æ–‡ä»¶
scp D:\certificates\fullchain.crt username@12.218.18.10:/home/username/nginx-shop/ssl/guopengfei.top/

# ä¸Šä¼ ç§é’¥æ–‡ä»¶
scp D:\certificates\private.key username@12.218.18.10:/home/username/nginx-shop/ssl/guopengfei.top/
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ WinSCP æˆ– FileZilla

1. ä½¿ç”¨ WinSCP æˆ– FileZilla è¿æ¥åˆ°æœåŠ¡å™¨
2. å¯¼èˆªåˆ°é¡¹ç›®ç›®å½•ï¼š`/home/username/nginx-shop/ssl/guopengfei.top/`
3. ä¸Šä¼ è¯ä¹¦æ–‡ä»¶

### æ–¹æ³•ä¸‰ï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»º

å¦‚æœè¯ä¹¦å†…å®¹åœ¨å‰ªè´´æ¿æˆ–æ–‡æœ¬ä¸­ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•
mkdir -p ssl/guopengfei.top

# åˆ›å»ºè¯ä¹¦æ–‡ä»¶ï¼ˆå¤åˆ¶ç²˜è´´å†…å®¹ï¼‰
nano ssl/guopengfei.top/fullchain.crt
# ç²˜è´´è¯ä¹¦å†…å®¹ï¼Œä¿å­˜é€€å‡ºï¼ˆCtrl+X, Y, Enterï¼‰

# åˆ›å»ºç§é’¥æ–‡ä»¶ï¼ˆå¤åˆ¶ç²˜è´´å†…å®¹ï¼‰
nano ssl/guopengfei.top/private.key
# ç²˜è´´ç§é’¥å†…å®¹ï¼Œä¿å­˜é€€å‡ºï¼ˆCtrl+X, Y, Enterï¼‰

# è®¾ç½®æƒé™
chmod 644 ssl/guopengfei.top/fullchain.crt
chmod 600 ssl/guopengfei.top/private.key
```

---

## ğŸ” éªŒè¯è¯ä¹¦æ–‡ä»¶

### æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨

```bash
# æ£€æŸ¥è¯ä¹¦æ–‡ä»¶
ls -la ssl/guopengfei.top/

# åº”è¯¥çœ‹åˆ°ï¼š
# -rw-r--r-- 1 user user  xxxx  fullchain.crt
# -rw------- 1 user user  xxxx  private.key
```

### æ£€æŸ¥è¯ä¹¦å†…å®¹

```bash
# æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯
openssl x509 -in ssl/guopengfei.top/fullchain.crt -text -noout

# æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ
openssl x509 -in ssl/guopengfei.top/fullchain.crt -noout -dates

# æŸ¥çœ‹ç§é’¥ä¿¡æ¯
openssl rsa -in ssl/guopengfei.top/private.key -check
```

### éªŒè¯è¯ä¹¦å’Œç§é’¥æ˜¯å¦åŒ¹é…

```bash
# æ£€æŸ¥è¯ä¹¦å’Œç§é’¥æ˜¯å¦åŒ¹é…
openssl x509 -noout -modulus -in ssl/guopengfei.top/fullchain.crt | openssl md5
openssl rsa -noout -modulus -in ssl/guopengfei.top/private.key | openssl md5

# å¦‚æœä¸¤ä¸ª MD5 å€¼ç›¸åŒï¼Œè¯´æ˜è¯ä¹¦å’Œç§é’¥åŒ¹é…
```

---

## ğŸ“ è¯ä¹¦æ–‡ä»¶æ ¼å¼è¯´æ˜

### PEM æ ¼å¼ï¼ˆNginx å¸¸ç”¨ï¼‰

è¯ä¹¦æ–‡ä»¶å†…å®¹ç¤ºä¾‹ï¼š

```
-----BEGIN CERTIFICATE-----
MIIFazCCA1OgAwIBAgIRAIIQz7DSQONZRGPgu2OCiwAwDQYJKoZIhvcNAQELBQAw
RTELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGElu
...
-----END CERTIFICATE-----
```

ç§é’¥æ–‡ä»¶å†…å®¹ç¤ºä¾‹ï¼š

```
-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC...
-----END PRIVATE KEY-----
```

### å¦‚æœä¸‹è½½çš„æ˜¯å…¶ä»–æ ¼å¼

å¦‚æœä¸‹è½½çš„æ˜¯ `.p12` æˆ– `.pfx` æ ¼å¼ï¼Œéœ€è¦è½¬æ¢ä¸º PEM æ ¼å¼ï¼š

```bash
# è½¬æ¢ä¸º PEM æ ¼å¼
openssl pkcs12 -in certificate.p12 -out fullchain.crt -clcerts -nokeys
openssl pkcs12 -in certificate.p12 -out private.key -nocerts -nodes
```

---

## âš ï¸ é‡è¦æç¤º

### 1. ç§é’¥å®‰å…¨

- âœ… ç§é’¥æ–‡ä»¶æƒé™å¿…é¡»è®¾ç½®ä¸º 600ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»ï¼‰
- âœ… ä¸è¦å°†ç§é’¥æ–‡ä»¶ä¸Šä¼ åˆ°å…¬å…±ä»“åº“ï¼ˆå¦‚ GitHubï¼‰
- âœ… ä¸è¦é€šè¿‡ä¸å®‰å…¨çš„æ¸ é“ä¼ è¾“ç§é’¥
- âœ… å®šæœŸå¤‡ä»½è¯ä¹¦å’Œç§é’¥æ–‡ä»¶

### 2. è¯ä¹¦æœ‰æ•ˆæœŸ

- è¯ä¹¦é€šå¸¸æœ‰æ•ˆæœŸä¸º 1 å¹´
- å»ºè®®åœ¨åˆ°æœŸå‰ 30 å¤©ç»­æœŸ
- ç»­æœŸåéœ€è¦æ›¿æ¢è¯ä¹¦æ–‡ä»¶å¹¶é‡æ–°åŠ è½½ Nginx

### 3. æ–‡ä»¶è·¯å¾„

- Nginx é…ç½®ä¸­çš„è¯ä¹¦è·¯å¾„ï¼š`/etc/nginx/ssl/guopengfei.top/fullchain.crt`
- åœ¨ Docker å®¹å™¨ä¸­ï¼Œè¿™ä¸ªè·¯å¾„å¯¹åº”ï¼š`./ssl/guopengfei.top/fullchain.crt`ï¼ˆé¡¹ç›®ç›®å½•ï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®Œæ•´æ­¥éª¤

```bash
# 1. åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºè¯ä¹¦ç›®å½•
mkdir -p ssl/guopengfei.top

# 2. ä¸Šä¼ è¯ä¹¦æ–‡ä»¶åˆ°æ­¤ç›®å½•
# fullchain.crt
# private.key

# 3. è®¾ç½®æ–‡ä»¶æƒé™
chmod 644 ssl/guopengfei.top/fullchain.crt
chmod 600 ssl/guopengfei.top/private.key

# 4. éªŒè¯æ–‡ä»¶
ls -la ssl/guopengfei.top/

# 5. é‡æ–°æ„å»ºå¹¶å¯åŠ¨ Docker å®¹å™¨
docker compose down
docker compose up -d --build

# 6. æŸ¥çœ‹æ—¥å¿—
docker compose logs -f nginx
```

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

- [ ] å·²åˆ›å»º `ssl/guopengfei.top/` ç›®å½•
- [ ] å·²ä¸Šä¼  `fullchain.crt` è¯ä¹¦æ–‡ä»¶
- [ ] å·²ä¸Šä¼  `private.key` ç§é’¥æ–‡ä»¶
- [ ] å·²è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ï¼ˆ644 å’Œ 600ï¼‰
- [ ] å·²éªŒè¯è¯ä¹¦å’Œç§é’¥åŒ¹é…
- [ ] å·²ä¿®æ”¹ `docker-compose.yml` æŒ‚è½½è¯ä¹¦ç›®å½•
- [ ] å·²ä¿®æ”¹ `nginx.conf` é…ç½® HTTPS
- [ ] å·²é‡æ–°æ„å»ºå¹¶å¯åŠ¨å®¹å™¨
- [ ] å¯ä»¥é€šè¿‡ HTTPS è®¿é—®ç½‘ç«™

---

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæ‚¨çš„è¯ä¹¦å°±é…ç½®å¥½äº†ï¼

